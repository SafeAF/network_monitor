<h1>Search Anomalies</h1>

<form class="netmon-filters" method="get">
  <label>Device <input name="device" value="<%= @filters[:device].to_s %>"></label>
  <label>Dst IP <input name="dst_ip" value="<%= @filters[:dst_ip].to_s %>"></label>
  <label>Dst Port <input name="dst_port" value="<%= @filters[:dst_port].to_s %>"></label>
  <label>Min Score <input name="min_score" value="<%= @filters[:min_score].to_s %>"></label>
  <label>Code <input name="code" value="<%= @filters[:code].to_s %>"></label>
  <label>
    Window
    <select name="window">
      <option value="" <%= "selected" if @filters[:window].to_s.empty? %>>Any</option>
      <option value="1h" <%= "selected" if @filters[:window] == "1h" %>>1h</option>
      <option value="24h" <%= "selected" if @filters[:window] == "24h" %>>24h</option>
      <option value="7d" <%= "selected" if @filters[:window] == "7d" %>>7d</option>
      <option value="30d" <%= "selected" if @filters[:window] == "30d" %>>30d</option>
    </select>
  </label>
  <button type="submit">Apply</button>
  <a href="/search/anomalies">Clear</a>
</form>

<%= render "saved_queries" %>

<table class="netmon-table">
  <thead>
    <tr>
      <th>Time</th>
      <th>Device</th>
      <th>Dst</th>
      <th>Port</th>
      <th>Score</th>
      <th>Summary</th>
    </tr>
  </thead>
  <tbody>
    <% @hits.each do |hit| %>
      <tr>
        <td><%= hit.occurred_at %></td>
        <td><%= hit.device&.name.presence || hit.device&.ip %></td>
        <td><%= hit.dst_ip %></td>
        <td><%= hit.dst_port %></td>
        <td><%= hit.score %></td>
        <td><%= hit.summary %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<div class="netmon-filters">
  <% if @page > 1 %>
    <a href="/search/anomalies?<%= request.query_parameters.merge(page: @page - 1).to_query %>">Prev</a>
  <% end %>
  <% if @page < @total_pages %>
    <a href="/search/anomalies?<%= request.query_parameters.merge(page: @page + 1).to_query %>">Next</a>
  <% end %>
</div>
